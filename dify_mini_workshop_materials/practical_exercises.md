# Dify業務自動化ワークフロー実践演習
## 演習：「ビジネスアシスタント」アプリの開発

### 概要
この演習では、日常業務をサポートする多機能ビジネスアシスタントアプリを作成します。このアプリは、メール文章の作成、会議の要約、タスク整理などの機能を持ち、ビジネスパーソンの業務効率化をサポートします。

### 学習目標
- Difyのワークフロー機能を使って実用的なアプリを構築する方法を学ぶ
- 質問分類器を使って入力内容に応じた処理の振り分けを実装する
- 条件分岐と変数を活用した柔軟なワークフローを構築する
- 実際のビジネスシーンで活用できるアプリを作成する

### 前提条件
- Difyアカウントの作成とログインが完了していること
- OpenAI APIキーが設定されていること（または共有アカウントを使用）

## 演習手順

### ステップ1：アプリの作成とワークフロー選択（5分）

1. Difyダッシュボードにログインする
2. 「新規アプリケーション作成」ボタンをクリック
3. アプリケーション名を「ビジネスアシスタント」と入力
4. アプリケーションタイプで「チャットフロー」を選択
5. 「作成」ボタンをクリック

### ステップ2：基本構造の設計（10分）

1. チャットフロービルダーを開く
2. 開始ノードを確認する（デフォルトで配置されています）
3. 質問分類器ノードを追加する
   - 開始ノードの「+」ボタンをクリック
   - 「質問分類器」を選択
4. 質問分類器に以下のクラスを設定する
   - クラス1：「メール文章作成の依頼」
   - クラス2：「会議メモの要約依頼」
   - クラス3：「タスク優先度付けの依頼」
   - クラス4：「その他の質問」

### ステップ3：メール文章生成機能の実装（15分）

1. 「メール文章作成の依頼」クラスの「+」ボタンをクリック
2. 「LLM」ノードを選択
3. LLMノードの設定を行う
   - モデル：GPT-3.5-turbo（または利用可能な最適なモデル）
   - システムプロンプト：
   ```
   あなたはプロフェッショナルなビジネスメール作成アシスタントです。
   ユーザーから提供された目的と要点に基づいて、適切なビジネスメールを作成してください。
   メールは日本語のビジネス文書として適切な敬語と構成で作成し、以下の形式に従ってください：

   1. 宛先（To）
   2. 件名（Subject）
   3. 挨拶
   4. 本文（要点を簡潔に伝える）
   5. 締めの言葉
   6. 署名

   ユーザーが提供していない情報は適切に補完してください。
   ```
   - ユーザープロンプト：{x}ボタンをクリックして「sys.text」を選択
4. LLMノードの「+」ボタンをクリック
5. 「回答」ノードを選択
6. 回答ノードの設定を行う
   - 回答テキスト：{x}ボタンをクリックして「前のノードの出力」を選択

### ステップ4：会議メモ要約機能の実装（15分）

1. 「会議メモの要約依頼」クラスの「+」ボタンをクリック
2. 「LLM」ノードを選択
3. LLMノードの設定を行う
   - モデル：GPT-3.5-turbo（または利用可能な最適なモデル）
   - システムプロンプト：
   ```
   あなたは会議メモを効率的に要約するアシスタントです。
   ユーザーから提供された会議メモを分析し、以下の形式で要約してください：

   1. 会議の目的
   2. 主要な議論ポイント（箇条書き3-5項目）
   3. 決定事項（箇条書き）
   4. 次のアクション（担当者と期限を含む箇条書き）
   5. フォローアップが必要な事項

   情報が不足している場合は、その旨を明記してください。
   要約は簡潔かつ具体的に、重要なポイントを漏らさないようにしてください。
   ```
   - ユーザープロンプト：{x}ボタンをクリックして「sys.text」を選択
4. LLMノードの「+」ボタンをクリック
5. 「回答」ノードを選択
6. 回答ノードの設定を行う
   - 回答テキスト：{x}ボタンをクリックして「前のノードの出力」を選択

### ステップ5：タスク優先度付け機能の実装（15分）

1. 「タスク優先度付けの依頼」クラスの「+」ボタンをクリック
2. 「LLM」ノードを選択
3. LLMノードの設定を行う
   - モデル：GPT-3.5-turbo（または利用可能な最適なモデル）
   - システムプロンプト：
   ```
   あなたはタスク管理のエキスパートです。
   ユーザーから提供された複数のタスクを分析し、重要度と緊急度に基づいて優先順位を付けてください。
   以下の形式で回答を構成してください：

   1. 最優先タスク（今すぐ取り組むべきもの）
   2. 高優先タスク（今日中に取り組むべきもの）
   3. 中優先タスク（今週中に取り組むべきもの）
   4. 低優先タスク（時間があれば取り組むもの）

   各タスクについて、優先度を決めた理由も簡潔に説明してください。
   また、効率的なタスク管理のためのアドバイスも1-2つ提供してください。
   ```
   - ユーザープロンプト：{x}ボタンをクリックして「sys.text」を選択
4. LLMノードの「+」ボタンをクリック
5. 「回答」ノードを選択
6. 回答ノードの設定を行う
   - 回答テキスト：{x}ボタンをクリックして「前のノードの出力」を選択

### ステップ6：その他の質問への対応（10分）

1. 「その他の質問」クラスの「+」ボタンをクリック
2. 「LLM」ノードを選択
3. LLMノードの設定を行う
   - モデル：GPT-3.5-turbo（または利用可能な最適なモデル）
   - システムプロンプト：
   ```
   あなたはビジネスアシスタントです。
   ユーザーからの質問に対して、簡潔かつ役立つ回答を提供してください。
   専門的な内容については、信頼できる情報源に基づいて回答し、不確かな情報には言及しないでください。
   ビジネスマナーや効率化のヒントなど、実用的なアドバイスを心がけてください。
   ```
   - ユーザープロンプト：{x}ボタンをクリックして「sys.text」を選択
4. LLMノードの「+」ボタンをクリック
5. 「回答」ノードを選択
6. 回答ノードの設定を行う
   - 回答テキスト：{x}ボタンをクリックして「前のノードの出力」を選択

### ステップ7：アプリのテストと公開（10分）

1. ワークフローは自動保存されます（保存ボタンはありません）
2. 「プレビュー」タブをクリックしてアプリをテスト
3. 各機能をテストするためのサンプル入力：
   - メール文章作成：「取引先への商品納期遅延のお詫びメールを作成してください。理由は部品調達の遅れです。」
   - 会議メモ要約：「以下の会議メモを要約してください：[会議メモの内容]」
   - タスク優先度付け：「以下のタスクの優先順位を教えてください：1. 月次レポート作成、2. クライアントミーティング準備、3. チームメンバーの評価面談、4. 新規プロジェクト企画書作成」
4. 必要に応じてプロンプトを調整
5. 「公開」ボタンをクリックしてアプリを公開

## 発展演習（時間に余裕がある場合）

### 発展1：ユーザー情報の活用

1. 開始ノードに変数を追加（ユーザー名、部署、役職など）
2. 各LLMノードのプロンプトに変数を組み込み、パーソナライズされた回答を生成

### 発展2：テンプレートの活用

1. よく使うメールテンプレートをテンプレートノードとして追加
2. ユーザーの入力に応じて適切なテンプレートを選択する条件分岐を実装

### 発展3：外部ツール連携

1. 天気情報やニュースなどの外部APIと連携するツールノードの追加
2. 外部情報を活用した回答の生成（例：「今日の天気に応じた商談の服装アドバイス」など）

## 演習のポイントと注意点

1. **プロンプト設計の重要性**：
   - 明確で具体的な指示をシステムプロンプトに含める
   - 出力フォーマットを指定して一貫性のある回答を得る

2. **質問分類器の精度向上**：
   - 各クラスの説明は具体的かつ網羅的に
   - 分類の境界が曖昧な場合は、追加のクラスを検討

3. **ユーザー体験の向上**：
   - エラーメッセージは親切で具体的に
   - 入力例や使い方のガイダンスを提供

4. **テストの重要性**：
   - 様々なケースでアプリをテスト
   - エッジケース（極端な入力など）も考慮

## 解答例

### メール文章生成の例

**入力**：
「取引先への商品納期遅延のお詫びメールを作成してください。理由は部品調達の遅れです。」

**出力**：
```
To: 株式会社〇〇 △△部 □□様

Subject: 【お詫び】商品納期遅延について

□□様

平素より格別のご高配を賜り、厚く御礼申し上げます。

この度は、ご注文いただいた商品の納期が遅延することとなり、誠に申し訳ございません。遅延の理由は、部品調達の遅れによるものでございます。現在、代替部品の手配を含め、最短での納品に向けて全力で対応しております。

現時点での納品予定日は〇月△日となっております。詳細なスケジュールにつきましては、確定次第、改めてご連絡させていただきます。

お客様にはご迷惑とご心配をおかけし、大変申し訳ございません。今後このようなことがないよう、部品調達体制の見直しと強化を図ってまいります。

何かご不明な点やご要望がございましたら、いつでもお申し付けください。引き続きご愛顧賜りますよう、何卒よろしくお願い申し上げます。

敬具

株式会社□□
営業部 〇〇
TEL: 03-XXXX-XXXX
Email: xxx@example.com
```

### 会議メモ要約の例

**入力**：
「以下の会議メモを要約してください：プロジェクトXの進捗会議。参加者：田中、鈴木、佐藤、高橋。議題1：システム開発の進捗状況。開発チームから報告あり、データベース設計が完了し、フロントエンド開発が80%完了。バックエンド開発は遅れており、追加リソースが必要。議題2：クライアントからの追加要望。UI変更とレポート機能の追加要望あり。見積もりと納期への影響を検討する必要あり。議題3：今後のスケジュール。現状のままだと納期に2週間の遅れが生じる可能性。対策として、外部リソースの活用を検討。次回会議は来週水曜日10時から。」

**出力**：
```
# プロジェクトX進捗会議 要約

## 会議の目的
プロジェクトXの進捗確認と課題対応の検討

## 主要な議論ポイント
- データベース設計完了、フロントエンド開発80%完了
- バックエンド開発に遅れあり、追加リソースが必要
- クライアントからUI変更とレポート機能の追加要望あり
- 現状では納期に2週間の遅れが生じる可能性

## 決定事項
- 外部リソースの活用を検討
- 追加要望について見積もりと納期への影響を検討

## 次のアクション
- バックエンド開発の追加リソース確保（担当：未定、期限：早急）
- クライアント追加要望の見積もり作成（担当：未定、期限：次回会議まで）
- 外部リソース活用の具体案作成（担当：未定、期限：次回会議まで）

## フォローアップが必要な事項
- 次回会議：来週水曜日10時
- バックエンド開発の遅れへの対応状況
- クライアント追加要望への対応方針
```

### タスク優先度付けの例

**入力**：
「以下のタスクの優先順位を教えてください：1. 月次レポート作成（提出期限：明後日）、2. クライアントミーティング準備（ミーティング：明日午後）、3. チームメンバーの評価面談（期限：今週金曜）、4. 新規プロジェクト企画書作成（提出期限：来週月曜）」

**出力**：
```
# タスク優先順位

## 最優先タスク（今すぐ取り組むべきもの）
- クライアントミーティング準備
  理由：明日午後に予定されており、最も期限が切迫しています。クライアント対応は事業継続に直結するため最優先です。

## 高優先タスク（今日中に取り組むべきもの）
- 月次レポート作成
  理由：提出期限が明後日と近く、レポート作成には一定の時間が必要です。また、定期的な業務報告は組織運営において重要です。

## 中優先タスク（今週中に取り組むべきもの）
- チームメンバーの評価面談
  理由：今週金曜が期限であり、面談準備と実施に時間を要します。チームマネジメントにおいて重要ですが、上記2つのタスクよりは時間的余裕があります。

## 低優先タスク（時間があれば取り組むもの）
- 新規プロジェクト企画書作成
  理由：提出期限が来週月曜と比較的余裕があります。ただし、企画書作成には創造的思考と時間が必要なため、少しずつ進めることをお勧めします。

## タスク管理のアドバイス
1. 「時間ブロッキング」を活用し、カレンダーに各タスクの作業時間を具体的に設定しましょう。特にクライアントミーティング準備と月次レポート作成には、集中できる時間帯を確保してください。

2. 新規プロジェクト企画書については、アイデアが浮かんだ時にメモを取る習慣をつけ、まとまった時間が取れなくても少しずつ進められるようにしましょう。
```
